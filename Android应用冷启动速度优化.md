# Android应用冷启动速度优化
有很多Android应用在首次启动时经常会出现现黑屏、白屏或者首帧出现慢的现象，本文就冷启动的速度优化进行探讨。
## Android应用启动方式
通常来说，在Android应用的启动方式分为：
* 冷启动
当启动应用时，后台没有该应用的进程，这时系统会重新创建一个新的进程分配给该应用。
* 热启动 当启动应用时，后台已有该应用的进程（比如home键切换到后台），这时系统会从已有的进程中来启动应用。
* 温启动 介于冷启动和热启动之间，不需要全新启动，只需要恢复Activity状态的情况。

简单地说，冷启动就是应用首次启动，热启动实际上只是从后台恢复应用，温启动介于之间，本文中只讨论冷启动。
## 冷启动的流程
根据Android官方文档《Launch-Time Performance》，应用冷启动之前，需要执行三个任务：
1. 加载和启动应用
2. App启动后，立即显示一个空的Window
3. 创建App的进程

紧接着系统创建App的进程，App进程会响应下面几个阶段：
1. 创建App对象
2. 启动主线程
3. 创建Main Activity
4. 加载Views
5. 布置屏幕
6. 开始初次绘制

一旦App进程完成第一次绘制，系统进程就会用Main Activity替换当前背景Window。此时，用户可以使用App了。

## 启动速度慢的原因
Android官方文档对应用冷启动速度慢总结的主要原因包括以下几种：
* 初始化太沉重，Application中做太多事情
* Activity初始化太沉重
 + 布局复杂
 + UI阻塞
 + 加载和解码很多图片
 + 绘制很多VectorDrable对象
* 启动页主题

## 启动速度优化方案
根据Android文档对于启动加速优化的思路，结合实际情况，可以有以下几方面的优化方法：
* 利用提前展示出来的Window，快速展示出来一个界面，给用户快速反馈
* 减少应用启动时的耗时操作
 + 在Application构造方法、attachBaseContext()、onCreate中不要有耗时操作，同时避免大量操作
* 定位耗时操作：
 + 避免I/O，比大量读取Sp
 + 反序列化
 + 网络操作
 + 布局嵌套
 
## 检测工具
如何定位耗时操作，google提供了一些工具，还有其他开源的工具，大家利用这些工具快速定位问题。以下是监测耗时操作的工具（因为文章篇幅问题，工具的用法请自行百度）：
* HierarchyViewer
* StrictMode
* TraceView
* Hugo 
